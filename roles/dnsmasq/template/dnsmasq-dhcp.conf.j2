#===============================================================#
#  Ansible                                                      #
#   this file is generated by the ansible automation controller #
#===============================================================#
{# Expected inputs
unifi_controller: ip_address
dns_server: ip_address
dhcp_subnets:
  - vlan_id: integer
    prefix_low: ip_address
    prefix_high: ip_address
    subnetmask: ip_mask
    router_address: ip_address
    static_hosts:
      - mac_address: mac_address
      - ip_address: ip_address
#}

dhcp-authoritative
dhcp-leasefile=/var/lib/dnsmasq/dnsmasq.leases

#-----{ Subnet Ranges }-------------------------
{% for subnet in dhcp_subnets %}
#-[ Vlan {{subnet.vlan_id}} {{subnet.vlan_description}} ]-#
dhcp-range=set:vlan{{subnet.vlan_id}},{{subnet.prefix_low}},{{subnet.prefix_high}},{{subnet.mask}}6h
dhcp-option=tag:vlan{{subnet.vlan_id}},option:dns-server,{{dns_server}}
dhcp-option=tag:vlan{{subnet.vlan_id}},option:router,{{subnet.router_address}}
#-[ Static Hosts ]-#
{% for host in subnet.static_hosts %}
dhcp-host={{host.mac_address}},{{host.ip_address}}
{% endfor %}

{% endfor %}
#-----{ Misc DHCP Options }-------------------------
{% if unifi_controller is defined %}
dhcp-option=vendor:ubnt,1,{{unifi_controller}}
{% endif %}
